<!DOCTYPE html>
<html>
<head>
  <title>l.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\jmespath\\l.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>l.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">var</span> Lexer = exports.Lexer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.pos = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">this</span>.buf = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.buflen = <span class="hljs-number">0</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Operator table, mapping operator -&gt; token name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.optable = {
    <span class="hljs-string">'+'</span>:  <span class="hljs-string">'PLUS'</span>,
    <span class="hljs-string">'-'</span>:  <span class="hljs-string">'MINUS'</span>,
    <span class="hljs-string">'*'</span>:  <span class="hljs-string">'MULTIPLY'</span>,
    <span class="hljs-string">'.'</span>:  <span class="hljs-string">'PERIOD'</span>,
    <span class="hljs-string">'\\'</span>: <span class="hljs-string">'BACKSLASH'</span>,
    <span class="hljs-string">':'</span>:  <span class="hljs-string">'COLON'</span>,
    <span class="hljs-string">'%'</span>:  <span class="hljs-string">'PERCENT'</span>,
    <span class="hljs-string">'|'</span>:  <span class="hljs-string">'PIPE'</span>,
    <span class="hljs-string">'!'</span>:  <span class="hljs-string">'EXCLAMATION'</span>,
    <span class="hljs-string">'?'</span>:  <span class="hljs-string">'QUESTION'</span>,
    <span class="hljs-string">'#'</span>:  <span class="hljs-string">'POUND'</span>,
    <span class="hljs-string">'&amp;'</span>:  <span class="hljs-string">'AMPERSAND'</span>,
    <span class="hljs-string">';'</span>:  <span class="hljs-string">'SEMI'</span>,
    <span class="hljs-string">','</span>:  <span class="hljs-string">'COMMA'</span>,
    <span class="hljs-string">'('</span>:  <span class="hljs-string">'L_PAREN'</span>,
    <span class="hljs-string">')'</span>:  <span class="hljs-string">'R_PAREN'</span>,
    <span class="hljs-string">'&lt;'</span>:  <span class="hljs-string">'L_ANG'</span>,
    <span class="hljs-string">'&gt;'</span>:  <span class="hljs-string">'R_ANG'</span>,
    <span class="hljs-string">'{'</span>:  <span class="hljs-string">'L_BRACE'</span>,
    <span class="hljs-string">'}'</span>:  <span class="hljs-string">'R_BRACE'</span>,
    <span class="hljs-string">'['</span>:  <span class="hljs-string">'L_BRACKET'</span>,
    <span class="hljs-string">']'</span>:  <span class="hljs-string">'R_BRACKET'</span>,
    <span class="hljs-string">'='</span>:  <span class="hljs-string">'EQUALS'</span>
  };
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Initialize the Lexer's buffer. This resets the lexer's internal
state and subsequent tokens will be returned starting with the
beginning of the new buffer.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">Lexer.prototype.input = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buf</span>) </span>{
  <span class="hljs-keyword">this</span>.pos = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">this</span>.buf = buf;
  <span class="hljs-keyword">this</span>.buflen = buf.length;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Get the next token from the current buffer. A token is an object with
the following properties:</p>
<ul>
<li>name: name of the pattern that this token matched (taken from rules).</li>
<li>value: actual string value of the token.</li>
<li>pos: offset in the current buffer where the token starts.</li>
</ul>
<p>If there are no more tokens in the buffer, returns null. In case of
an error throws Error.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">Lexer.prototype.token = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>._skipnontokens();
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pos &gt;= <span class="hljs-keyword">this</span>.buflen) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>The char at this.pos is part of a real token. Figure out which.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.buf.charAt(<span class="hljs-keyword">this</span>.pos);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>'/' is treated specially, because it starts a comment if followed by
another '/'. If not followed by another '/', it's the DIVIDE
operator.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (c === <span class="hljs-string">'/'</span>) {
    <span class="hljs-keyword">var</span> next_c = <span class="hljs-keyword">this</span>.buf.charAt(<span class="hljs-keyword">this</span>.pos + <span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span> (next_c === <span class="hljs-string">'/'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._process_comment();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> {<span class="hljs-attr">name</span>: <span class="hljs-string">'DIVIDE'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">pos</span>: <span class="hljs-keyword">this</span>.pos++};
    }
  } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Look it up in the table of operators</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> op = <span class="hljs-keyword">this</span>.optable[c];
    <span class="hljs-keyword">if</span> (op !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">return</span> {<span class="hljs-attr">name</span>: op, <span class="hljs-attr">value</span>: c, <span class="hljs-attr">pos</span>: <span class="hljs-keyword">this</span>.pos++};
    } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Not an operator - so it's the beginning of another token.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (Lexer._isalpha(c)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._process_identifier();
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Lexer._isdigit(c)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._process_number();
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c === <span class="hljs-string">'"'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._process_quote();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Token error at '</span> + <span class="hljs-keyword">this</span>.pos);
      }
    }
  }
}

Lexer._isnewline = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>{
  <span class="hljs-keyword">return</span> c === <span class="hljs-string">'\r'</span> || c === <span class="hljs-string">'\n'</span>;
}

Lexer._isdigit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>{
  <span class="hljs-keyword">return</span> c &gt;= <span class="hljs-string">'0'</span> &amp;&amp; c &lt;= <span class="hljs-string">'9'</span>;
}

Lexer._isalpha = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>{
  <span class="hljs-keyword">return</span> (c &gt;= <span class="hljs-string">'a'</span> &amp;&amp; c &lt;= <span class="hljs-string">'z'</span>) ||
         (c &gt;= <span class="hljs-string">'A'</span> &amp;&amp; c &lt;= <span class="hljs-string">'Z'</span>) ||
         c === <span class="hljs-string">'_'</span> || c === <span class="hljs-string">'$'</span>;
}

Lexer._isalphanum = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>{
  <span class="hljs-keyword">return</span> (c &gt;= <span class="hljs-string">'a'</span> &amp;&amp; c &lt;= <span class="hljs-string">'z'</span>) ||
         (c &gt;= <span class="hljs-string">'A'</span> &amp;&amp; c &lt;= <span class="hljs-string">'Z'</span>) ||
         (c &gt;= <span class="hljs-string">'0'</span> &amp;&amp; c &lt;= <span class="hljs-string">'9'</span>) ||
         c === <span class="hljs-string">'_'</span> || c === <span class="hljs-string">'$'</span>;
}

Lexer.prototype._process_number = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> endpos = <span class="hljs-keyword">this</span>.pos + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">while</span> (endpos &lt; <span class="hljs-keyword">this</span>.buflen &amp;&amp;
         Lexer._isdigit(<span class="hljs-keyword">this</span>.buf.charAt(endpos))) {
    endpos++;
  }

  <span class="hljs-keyword">var</span> tok = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'NUMBER'</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-keyword">this</span>.buf.substring(<span class="hljs-keyword">this</span>.pos, endpos),
    <span class="hljs-attr">pos</span>: <span class="hljs-keyword">this</span>.pos
  };
  <span class="hljs-keyword">this</span>.pos = endpos;
  <span class="hljs-keyword">return</span> tok;
}

Lexer.prototype._process_comment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> endpos = <span class="hljs-keyword">this</span>.pos + <span class="hljs-number">2</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Skip until the end of the line</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.buf.charAt(<span class="hljs-keyword">this</span>.pos + <span class="hljs-number">2</span>);
  <span class="hljs-keyword">while</span> (endpos &lt; <span class="hljs-keyword">this</span>.buflen &amp;&amp;
         !Lexer._isnewline(<span class="hljs-keyword">this</span>.buf.charAt(endpos))) {
    endpos++;
  }

  <span class="hljs-keyword">var</span> tok = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'COMMENT'</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-keyword">this</span>.buf.substring(<span class="hljs-keyword">this</span>.pos, endpos),
    <span class="hljs-attr">pos</span>: <span class="hljs-keyword">this</span>.pos
  };
  <span class="hljs-keyword">this</span>.pos = endpos + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">return</span> tok;
}

Lexer.prototype._process_identifier = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> endpos = <span class="hljs-keyword">this</span>.pos + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">while</span> (endpos &lt; <span class="hljs-keyword">this</span>.buflen &amp;&amp;
         Lexer._isalphanum(<span class="hljs-keyword">this</span>.buf.charAt(endpos))) {
    endpos++;
  }

  <span class="hljs-keyword">var</span> tok = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'IDENTIFIER'</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-keyword">this</span>.buf.substring(<span class="hljs-keyword">this</span>.pos, endpos),
    <span class="hljs-attr">pos</span>: <span class="hljs-keyword">this</span>.pos
  };
  <span class="hljs-keyword">this</span>.pos = endpos;
  <span class="hljs-keyword">return</span> tok;
}

Lexer.prototype._process_quote = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>this.pos points at the opening quote. Find the ending quote.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> end_index = <span class="hljs-keyword">this</span>.buf.indexOf(<span class="hljs-string">'"'</span>, <span class="hljs-keyword">this</span>.pos + <span class="hljs-number">1</span>);

  <span class="hljs-keyword">if</span> (end_index === <span class="hljs-number">-1</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Unterminated quote at '</span> + <span class="hljs-keyword">this</span>.pos);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> tok = {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'QUOTE'</span>,
      <span class="hljs-attr">value</span>: <span class="hljs-keyword">this</span>.buf.substring(<span class="hljs-keyword">this</span>.pos, end_index + <span class="hljs-number">1</span>),
      <span class="hljs-attr">pos</span>: <span class="hljs-keyword">this</span>.pos
    };
    <span class="hljs-keyword">this</span>.pos = end_index + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> tok;
  }
}

Lexer.prototype._skipnontokens = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">while</span> (<span class="hljs-keyword">this</span>.pos &lt; <span class="hljs-keyword">this</span>.buflen) {
    <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.buf.charAt(<span class="hljs-keyword">this</span>.pos);
    <span class="hljs-keyword">if</span> (c == <span class="hljs-string">' '</span> || c == <span class="hljs-string">'\t'</span> || c == <span class="hljs-string">'\r'</span> || c == <span class="hljs-string">'\n'</span>) {
      <span class="hljs-keyword">this</span>.pos++;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">break</span>;
    }
  }
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
