<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\content-type\\index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>!
content-type
Copyright(c) 2015 Douglas Christopher Wilson
MIT Licensed</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>RegExp to match *( &quot;;&quot; parameter ) in RFC 7231 sec 3.1.1.1</p>
</div>
<div class="body">
<p>parameter     = token &quot;=&quot; ( token / quoted-string )
token         = 1<em>tchar
tchar         = &quot;!&quot; / &quot;#&quot; / &quot;$&quot; / &quot;%&quot; / &quot;&amp;&quot; / &quot;'&quot; / &quot;</em>&quot;
/ &quot;+&quot; / &quot;-&quot; / &quot;.&quot; / &quot;^&quot; / &quot;_&quot; / &quot;`&quot; / &quot;|&quot; / &quot;~&quot;
/ DIGIT / ALPHA
; any VCHAR, except delimiters
quoted-string = DQUOTE *( qdtext / quoted-pair ) DQUOTE
qdtext        = HTAB / SP / %x21 / %x23-5B / %x5D-7E / obs-text
obs-text      = %x80-FF
quoted-pair   = &quot;&quot; ( HTAB / SP / VCHAR / obs-text )</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> PARAM_REGEXP = <span class="hljs-regexp">/; *([!#$%&amp;'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&amp;'*+.^_`|~0-9A-Za-z-]+) */g</span>
<span class="hljs-keyword">var</span> TEXT_REGEXP = <span class="hljs-regexp">/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/</span>
<span class="hljs-keyword">var</span> TOKEN_REGEXP = <span class="hljs-regexp">/^[!#$%&amp;'*+.^_`|~0-9A-Za-z-]+$/</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>RegExp to match quoted-pair in RFC 7230 sec 3.2.6</p>
</div>
<div class="body">
<p>quoted-pair = &quot;&quot; ( HTAB / SP / VCHAR / obs-text )
obs-text    = %x80-FF</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> QESC_REGEXP = <span class="hljs-regexp">/\\([\u000b\u0020-\u00ff])/g</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>RegExp to match chars that must be quoted-pair in RFC 7230 sec 3.2.6</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> QUOTE_REGEXP = <span class="hljs-regexp">/([\\"])/g</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>RegExp to match type in RFC 7231 sec 3.1.1.1</p>
</div>
<div class="body">
<p>media-type = type &quot;/&quot; subtype
type       = token
subtype    = token</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> TYPE_REGEXP = <span class="hljs-regexp">/^[!#$%&amp;'*+.^_`|~0-9A-Za-z-]+\/[!#$%&amp;'*+.^_`|~0-9A-Za-z-]+$/</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module exports.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.format = format
exports.parse = parse

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Format object to media type.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">obj</span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format</span> (<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">if</span> (!obj || <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">'object'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'argument obj is required'</span>)
  }

  <span class="hljs-keyword">var</span> parameters = obj.parameters
  <span class="hljs-keyword">var</span> type = obj.type

  <span class="hljs-keyword">if</span> (!type || !TYPE_REGEXP.test(type)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid type'</span>)
  }

  <span class="hljs-keyword">var</span> string = type

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>append parameters</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (parameters &amp;&amp; <span class="hljs-keyword">typeof</span> parameters === <span class="hljs-string">'object'</span>) {
    <span class="hljs-keyword">var</span> param
    <span class="hljs-keyword">var</span> params = <span class="hljs-built_in">Object</span>.keys(parameters).sort()

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; params.length; i++) {
      param = params[i]

      <span class="hljs-keyword">if</span> (!TOKEN_REGEXP.test(param)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid parameter name'</span>)
      }

      string += <span class="hljs-string">'; '</span> + param + <span class="hljs-string">'='</span> + qstring(parameters[param])
    }
  }

  <span class="hljs-keyword">return</span> string
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Parse media type to object.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span class="dox_type">string</span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse</span> (<span class="hljs-params">string</span>) </span>{
  <span class="hljs-keyword">if</span> (!string) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'argument string is required'</span>)
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>support req/res-like objects as argument</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> header = <span class="hljs-keyword">typeof</span> string === <span class="hljs-string">'object'</span>
    ? getcontenttype(string)
    : string

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> header !== <span class="hljs-string">'string'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'argument string is required to be a string'</span>)
  }

  <span class="hljs-keyword">var</span> index = header.indexOf(<span class="hljs-string">';'</span>)
  <span class="hljs-keyword">var</span> type = index !== <span class="hljs-number">-1</span>
    ? header.substr(<span class="hljs-number">0</span>, index).trim()
    : header.trim()

  <span class="hljs-keyword">if</span> (!TYPE_REGEXP.test(type)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid media type'</span>)
  }

  <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span> ContentType(type.toLowerCase())

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>parse parameters</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (index !== <span class="hljs-number">-1</span>) {
    <span class="hljs-keyword">var</span> key
    <span class="hljs-keyword">var</span> match
    <span class="hljs-keyword">var</span> value

    PARAM_REGEXP.lastIndex = index

    <span class="hljs-keyword">while</span> ((match = PARAM_REGEXP.exec(header))) {
      <span class="hljs-keyword">if</span> (match.index !== index) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid parameter format'</span>)
      }

      index += match[<span class="hljs-number">0</span>].length
      key = match[<span class="hljs-number">1</span>].toLowerCase()
      value = match[<span class="hljs-number">2</span>]

      <span class="hljs-keyword">if</span> (value[<span class="hljs-number">0</span>] === <span class="hljs-string">'"'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>remove quotes and escapes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        value = value
          .substr(<span class="hljs-number">1</span>, value.length - <span class="hljs-number">2</span>)
          .replace(QESC_REGEXP, <span class="hljs-string">'$1'</span>)
      }

      obj.parameters[key] = value
    }

    <span class="hljs-keyword">if</span> (index !== header.length) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid parameter format'</span>)
    }
  }

  <span class="hljs-keyword">return</span> obj
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get content-type from req/res objects.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getcontenttype</span> (<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">var</span> header

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj.getHeader === <span class="hljs-string">'function'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>res-like</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    header = obj.getHeader(<span class="hljs-string">'content-type'</span>)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj.headers === <span class="hljs-string">'object'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>req-like</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    header = obj.headers &amp;&amp; obj.headers[<span class="hljs-string">'content-type'</span>]
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> header !== <span class="hljs-string">'string'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'content-type header is missing from object'</span>)
  }

  <span class="hljs-keyword">return</span> header
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<div class="dox">
<div class="summary">
<p>Quote a string if necessary.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">val</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qstring</span> (<span class="hljs-params">val</span>) </span>{
  <span class="hljs-keyword">var</span> str = <span class="hljs-built_in">String</span>(val)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>no need to quote tokens</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (TOKEN_REGEXP.test(str)) {
    <span class="hljs-keyword">return</span> str
  }

  <span class="hljs-keyword">if</span> (str.length &gt; <span class="hljs-number">0</span> &amp;&amp; !TEXT_REGEXP.test(str)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid parameter value'</span>)
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">'"'</span> + str.replace(QUOTE_REGEXP, <span class="hljs-string">'\\$1'</span>) + <span class="hljs-string">'"'</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<div class="dox">
<div class="summary">
<p>Class to represent a content type.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ContentType</span> (<span class="hljs-params">type</span>) </span>{
  <span class="hljs-keyword">this</span>.parameters = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">this</span>.type = type
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
