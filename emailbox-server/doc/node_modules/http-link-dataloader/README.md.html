<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\http-link-dataloader\\README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#http-link-dataloader">http-link-dataloader</a>
      </div>

      <div class="heading h2">
        <a href="#idea">Idea</a>
      </div>

      <div class="heading h2">
        <a href="#usage">Usage</a>
      </div>

      <div class="heading h2">
        <a href="#caching-behavior">Caching behavior</a>
      </div>

      <div class="heading h2">
        <a href="#batching">Batching</a>
      </div>

      <div class="heading h2">
        <a href="#even-better-batching">Even better batching</a>
      </div>

      <div class="heading h2">
        <a href="#help-and-community">Help &amp;amp; Community </a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="http-link-dataloader">
  <h1>
    <a href="#http-link-dataloader" name="http-link-dataloader" class="pilcrow"></a>
http-link-dataloader
  </h1>
</div>
<p><a href="https://circleci.com/gh/graphcool/http-link-dataloader"><img src="https://circleci.com/gh/graphcool/http-link-dataloader.svg?style=shield" alt="CircleCI"></a> <a href="https://badge.fury.io/js/http-link-dataloader"><img src="https://badge.fury.io/js/http-link-dataloader.svg" alt="npm version"></a></p>
<p>ðŸ“šðŸ“¡ HTTP Apollo Link with batching &amp; caching provided by dataloader.</p>
<div class="pilwrap" id="idea">
  <h2>
    <a href="#idea" name="idea" class="pilcrow"></a>
Idea
  </h2>
</div>
<p>A Apollo Link that batches requests both in Node and the Browser.
You may ask what's the difference to <a href="https://github.com/apollographql/apollo-link/tree/master/packages/apollo-link-batch-http">apollo-link-batch-http</a>.
Instead of having a time-frame/fixed cache size based batching approach like in <code>apollo-link-batch-http</code>, this library uses <a href="https://github.com/facebook/dataloader">dataloader</a> for batching requests. It is a more generic approach just depending on the Node.JS event loop that batches all consecutive queries directly.
The main use-case for this library is the usage from a <a href="https://github.com/graphcool/graphql-yoga"><code>graphql-yoga</code></a> server using <a href="https://github.com/graphcool/prisma-binding"><code>prisma-binding</code></a>, but it can be used in any environment, even the browser as the latest <code>dataloader</code> version also runs in browser environments.</p>
<div class="pilwrap" id="usage">
  <h2>
    <a href="#usage" name="usage" class="pilcrow"></a>
Usage
  </h2>
</div>
<pre><code class="ts"><span class="hljs-keyword">import</span> { HTTPLinkDataloader } <span class="hljs-keyword">from</span> <span class="hljs-string">'http-link-dataloader'</span>

<span class="hljs-keyword">const</span> link = <span class="hljs-keyword">new</span> HTTPLinkDataloader()

<span class="hljs-keyword">const</span> token = <span class="hljs-string">'Auth Token'</span>

<span class="hljs-keyword">const</span> httpLink = <span class="hljs-keyword">new</span> HTTPLinkDataloader({
  uri: <span class="hljs-string">`api endpoint`</span>,
  headers: { Authorization: <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span> },
})
</code></pre>
<div class="pilwrap" id="caching-behavior">
  <h2>
    <a href="#caching-behavior" name="caching-behavior" class="pilcrow"></a>
Caching behavior
  </h2>
</div>
<p>Note that the dataloader cache aggressively caches everything! That means if you don't want to cache anymore, just create a new instance of <code>BatchedHTTPLink</code>.
A good fit for this is every incoming HTTP request in a server environment - on each new HTTP request a new <code>BatchedHTTPLink</code> instance is created.</p>
<div class="pilwrap" id="batching">
  <h2>
    <a href="#batching" name="batching" class="pilcrow"></a>
Batching
  </h2>
</div>
<p>This library uses array-based batching. Querying 2 queries like this creates the following payload:</p>
<pre><code class="graphql">query {
  Item(id: &quot;1&quot;) {
    id
    name
    text
  }
}
</code></pre>
<pre><code class="graphql">query {
  Item(id: &quot;2&quot;) {
    id
    name
    text
  }
}
</code></pre>
<p>Instead of sending 2 separate http requests, it gets combined into one:</p>
<pre><code class="js">;[
  {
    <span class="hljs-attr">query</span>: <span class="hljs-string">`query {
      Item(id: "1") {
        id
        name
        text
      }
    }`</span>,
  },
  {
    <span class="hljs-attr">query</span>: <span class="hljs-string">`query {
      Item(id: "2") {
        id
        name
        text
      }
    }`</span>,
  },
]
</code></pre>
<p><strong>Note that the GraphQL Server needs to support the array-based batching!</strong>
(Prisma supports this out of the box)</p>
<div class="pilwrap" id="even-better-batching">
  <h2>
    <a href="#even-better-batching" name="even-better-batching" class="pilcrow"></a>
Even better batching
  </h2>
</div>
<p>A batching that would even be faster is alias-based batching. Instead of creating the array described above, it would generate something like this:</p>
<pre><code class="js">{
  <span class="hljs-attr">query</span>: <span class="hljs-string">`
    query {
      item_1: Item(id: "1") {
        id
        name
        text
      }
      item_2: Item(id: "2") {
        id
        name
        text
      }
    }`</span>
}
</code></pre>
<p>This requires a lot more logic and resolution magic for aliases, but would be a lot faster than the array based batching as our tests have shown!
Anyone intersted in working on this is more than welcome to do so!
You can either create an issue or just reach out to us in slack and join our #contributors channel.</p>
<div class="pilwrap" id="help-and-community">
  <h2>
    <a href="#help-and-community" name="help-and-community" class="pilcrow"></a>
Help &amp; Community <a href="https://slack.graph.cool"><img src="https://slack.graph.cool/badge.svg" alt="Slack Status"></a>
  </h2>
</div>
<p>Join our <a href="http://slack.graph.cool/">Slack community</a> if you run into issues or have questions. We love talking to you!</p>
<p><img src="http://i.imgur.com/5RHR6Ku.png" alt=""></p>
</div>
  </div>
</body>
</html>
