<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\media-typer\\index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>!
media-typer
Copyright(c) 2014 Douglas Christopher Wilson
MIT Licensed</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>RegExp to match *( &quot;;&quot; parameter ) in RFC 2616 sec 3.7</p>
</div>
<div class="body">
<p>parameter     = token &quot;=&quot; ( token | quoted-string )
token         = 1*<any CHAR except CTLs or separators>
separators    = &quot;(&quot; | &quot;)&quot; | &quot;&lt;&quot; | &quot;&gt;&quot; | &quot;@&quot;
| &quot;,&quot; | &quot;;&quot; | &quot;:&quot; | &quot;&quot; | &lt;&quot;&gt;
| &quot;/&quot; | &quot;[&quot; | &quot;]&quot; | &quot;?&quot; | &quot;=&quot;
| &quot;{&quot; | &quot;}&quot; | SP | HT
quoted-string = ( &lt;&quot;&gt; <em>(qdtext | quoted-pair ) &lt;&quot;&gt; )
qdtext        = &lt;any TEXT except &lt;&quot;&gt;&gt;
quoted-pair   = &quot;&quot; CHAR
CHAR          = &lt;any US-ASCII character (octets 0 - 127)&gt;
TEXT          = &lt;any OCTET except CTLs, but including LWS&gt;
LWS           = [CRLF] 1</em>( SP | HT )
CRLF          = CR LF
CR            = &lt;US-ASCII CR, carriage return (13)&gt;
LF            = &lt;US-ASCII LF, linefeed (10)&gt;
SP            = &lt;US-ASCII SP, space (32)&gt;
SHT           = &lt;US-ASCII HT, horizontal-tab (9)&gt;
CTL           = &lt;any US-ASCII control character (octets 0 - 31) and DEL (127)&gt;
OCTET         = &lt;any 8-bit sequence of data&gt;</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> paramRegExp = <span class="hljs-regexp">/; *([!#$%&amp;'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u0020-\u007e])*"|[!#$%&amp;'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g</span>;
<span class="hljs-keyword">var</span> textRegExp = <span class="hljs-regexp">/^[\u0020-\u007e\u0080-\u00ff]+$/</span>
<span class="hljs-keyword">var</span> tokenRegExp = <span class="hljs-regexp">/^[!#$%&amp;'\*\+\-\.0-9A-Z\^_`a-z\|~]+$/</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>RegExp to match quoted-pair in RFC 2616</p>
</div>
<div class="body">
<p>quoted-pair = &quot;&quot; CHAR
CHAR        = &lt;any US-ASCII character (octets 0 - 127)&gt;</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> qescRegExp = <span class="hljs-regexp">/\\([\u0000-\u007f])/g</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>RegExp to match chars that must be quoted-pair in RFC 2616</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> quoteRegExp = <span class="hljs-regexp">/([\\"])/g</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>RegExp to match type in RFC 6838</p>
</div>
<div class="body">
<p>type-name = restricted-name
subtype-name = restricted-name
restricted-name = restricted-name-first *126restricted-name-chars
restricted-name-first  = ALPHA / DIGIT
restricted-name-chars  = ALPHA / DIGIT / &quot;!&quot; / &quot;#&quot; /
&quot;$&quot; / &quot;&amp;&quot; / &quot;-&quot; / &quot;^&quot; / &quot;_&quot;
restricted-name-chars =/ &quot;.&quot; ; Characters before first dot always
; specify a facet name
restricted-name-chars =/ &quot;+&quot; ; Characters after last plus always
; specify a structured syntax suffix
ALPHA =  %x41-5A / %x61-7A   ; A-Z / a-z
DIGIT =  %x30-39             ; 0-9</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> subtypeNameRegExp = <span class="hljs-regexp">/^[A-Za-z0-9][A-Za-z0-9!#$&amp;^_.-]{0,126}$/</span>
<span class="hljs-keyword">var</span> typeNameRegExp = <span class="hljs-regexp">/^[A-Za-z0-9][A-Za-z0-9!#$&amp;^_-]{0,126}$/</span>
<span class="hljs-keyword">var</span> typeRegExp = <span class="hljs-regexp">/^ *([A-Za-z0-9][A-Za-z0-9!#$&amp;^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&amp;^_.+-]{0,126}) *$/</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module exports.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
exports.format = format
exports.parse = parse

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Format object to media type.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">obj</span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">public</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format</span>(<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">if</span> (!obj || <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">'object'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'argument obj is required'</span>)
  }

  <span class="hljs-keyword">var</span> parameters = obj.parameters
  <span class="hljs-keyword">var</span> subtype = obj.subtype
  <span class="hljs-keyword">var</span> suffix = obj.suffix
  <span class="hljs-keyword">var</span> type = obj.type

  <span class="hljs-keyword">if</span> (!type || !typeNameRegExp.test(type)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid type'</span>)
  }

  <span class="hljs-keyword">if</span> (!subtype || !subtypeNameRegExp.test(subtype)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid subtype'</span>)
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>format as type/subtype</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> string = type + <span class="hljs-string">'/'</span> + subtype

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>append +suffix</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (suffix) {
    <span class="hljs-keyword">if</span> (!typeNameRegExp.test(suffix)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid suffix'</span>)
    }

    string += <span class="hljs-string">'+'</span> + suffix
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>append parameters</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (parameters &amp;&amp; <span class="hljs-keyword">typeof</span> parameters === <span class="hljs-string">'object'</span>) {
    <span class="hljs-keyword">var</span> param
    <span class="hljs-keyword">var</span> params = <span class="hljs-built_in">Object</span>.keys(parameters).sort()

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; params.length; i++) {
      param = params[i]

      <span class="hljs-keyword">if</span> (!tokenRegExp.test(param)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid parameter name'</span>)
      }

      string += <span class="hljs-string">'; '</span> + param + <span class="hljs-string">'='</span> + qstring(parameters[param])
    }
  }

  <span class="hljs-keyword">return</span> string
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<div class="dox">
<div class="summary">
<p>Parse media type to object.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span class="dox_type">string</span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">public</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse</span>(<span class="hljs-params">string</span>) </span>{
  <span class="hljs-keyword">if</span> (!string) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'argument string is required'</span>)
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>support req/res-like objects as argument</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> string === <span class="hljs-string">'object'</span>) {
    string = getcontenttype(string)
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> string !== <span class="hljs-string">'string'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'argument string is required to be a string'</span>)
  }

  <span class="hljs-keyword">var</span> index = string.indexOf(<span class="hljs-string">';'</span>)
  <span class="hljs-keyword">var</span> type = index !== <span class="hljs-number">-1</span>
    ? string.substr(<span class="hljs-number">0</span>, index)
    : string

  <span class="hljs-keyword">var</span> key
  <span class="hljs-keyword">var</span> match
  <span class="hljs-keyword">var</span> obj = splitType(type)
  <span class="hljs-keyword">var</span> params = {}
  <span class="hljs-keyword">var</span> value

  paramRegExp.lastIndex = index

  <span class="hljs-keyword">while</span> (match = paramRegExp.exec(string)) {
    <span class="hljs-keyword">if</span> (match.index !== index) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid parameter format'</span>)
    }

    index += match[<span class="hljs-number">0</span>].length
    key = match[<span class="hljs-number">1</span>].toLowerCase()
    value = match[<span class="hljs-number">2</span>]

    <span class="hljs-keyword">if</span> (value[<span class="hljs-number">0</span>] === <span class="hljs-string">'"'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>remove quotes and escapes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      value = value
        .substr(<span class="hljs-number">1</span>, value.length - <span class="hljs-number">2</span>)
        .replace(qescRegExp, <span class="hljs-string">'$1'</span>)
    }

    params[key] = value
  }

  <span class="hljs-keyword">if</span> (index !== <span class="hljs-number">-1</span> &amp;&amp; index !== string.length) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid parameter format'</span>)
  }

  obj.parameters = params

  <span class="hljs-keyword">return</span> obj
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get content-type from req/res objects.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getcontenttype</span>(<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj.getHeader === <span class="hljs-string">'function'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>res-like</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> obj.getHeader(<span class="hljs-string">'content-type'</span>)
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj.headers === <span class="hljs-string">'object'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>req-like</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> obj.headers &amp;&amp; obj.headers[<span class="hljs-string">'content-type'</span>]
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Quote a string if necessary.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">val</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qstring</span>(<span class="hljs-params">val</span>) </span>{
  <span class="hljs-keyword">var</span> str = <span class="hljs-built_in">String</span>(val)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>no need to quote tokens</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (tokenRegExp.test(str)) {
    <span class="hljs-keyword">return</span> str
  }

  <span class="hljs-keyword">if</span> (str.length &gt; <span class="hljs-number">0</span> &amp;&amp; !textRegExp.test(str)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid parameter value'</span>)
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">'"'</span> + str.replace(quoteRegExp, <span class="hljs-string">'\\$1'</span>) + <span class="hljs-string">'"'</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<div class="dox">
<div class="summary">
<p>Simply &quot;type/subtype+siffx&quot; into parts.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">splitType</span>(<span class="hljs-params">string</span>) </span>{
  <span class="hljs-keyword">var</span> match = typeRegExp.exec(string.toLowerCase())

  <span class="hljs-keyword">if</span> (!match) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'invalid media type'</span>)
  }

  <span class="hljs-keyword">var</span> type = match[<span class="hljs-number">1</span>]
  <span class="hljs-keyword">var</span> subtype = match[<span class="hljs-number">2</span>]
  <span class="hljs-keyword">var</span> suffix

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>suffix after last +</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> index = subtype.lastIndexOf(<span class="hljs-string">'+'</span>)
  <span class="hljs-keyword">if</span> (index !== <span class="hljs-number">-1</span>) {
    suffix = subtype.substr(index + <span class="hljs-number">1</span>)
    subtype = subtype.substr(<span class="hljs-number">0</span>, index)
  }

  <span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">type</span>: type,
    <span class="hljs-attr">subtype</span>: subtype,
    <span class="hljs-attr">suffix</span>: suffix
  }

  <span class="hljs-keyword">return</span> obj
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
