<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\dataloader\\index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_classCallCheck</span>(<span class="hljs-params">instance, Constructor</span>) </span>{ <span class="hljs-keyword">if</span> (!(instance <span class="hljs-keyword">instanceof</span> Constructor)) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"Cannot call a class as a function"</span>); } }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>A <code>DataLoader</code> creates a public API for loading data from a particular
data back-end with unique keys such as the <code>id</code> column of a SQL table or
document name in a MongoDB database, given a batch loading function.</p>
</div>
<div class="body">
<p>Each <code>DataLoader</code> instance contains a unique memoized cache. Use caution when
used in long-lived applications or those which serve many users with
different access permissions and consider creating a new instance per
web request.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Optionally turn off batching or caching or provide a cache key function or a
custom cache instance.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> DataLoader = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">DataLoader</span>(<span class="hljs-params">batchLoadFn, options</span>) </span>{
    _classCallCheck(<span class="hljs-keyword">this</span>, DataLoader);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> batchLoadFn !== <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'DataLoader must be constructed with a function which accepts '</span> + (<span class="hljs-string">'Array&lt;key&gt; and returns Promise&lt;Array&lt;value&gt;&gt;, but got: '</span> + batchLoadFn + <span class="hljs-string">'.'</span>));
    }
    <span class="hljs-keyword">this</span>._batchLoadFn = batchLoadFn;
    <span class="hljs-keyword">this</span>._options = options;
    <span class="hljs-keyword">this</span>._promiseCache = getValidCacheMap(options);
    <span class="hljs-keyword">this</span>._queue = [];
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Private</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Loads a key, returning a <code>Promise</code> for the value represented by that key.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  DataLoader.prototype.load = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">load</span>(<span class="hljs-params">key</span>) </span>{
    <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">if</span> (key === <span class="hljs-literal">null</span> || key === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'The loader.load() function must be called with a value,'</span> + (<span class="hljs-string">'but got: '</span> + <span class="hljs-built_in">String</span>(key) + <span class="hljs-string">'.'</span>));
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Determine options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> options = <span class="hljs-keyword">this</span>._options;
    <span class="hljs-keyword">var</span> shouldBatch = !options || options.batch !== <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> shouldCache = !options || options.cache !== <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> cacheKeyFn = options &amp;&amp; options.cacheKeyFn;
    <span class="hljs-keyword">var</span> cacheKey = cacheKeyFn ? cacheKeyFn(key) : key;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>If caching and there is a cache-hit, return cached Promise.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (shouldCache) {
      <span class="hljs-keyword">var</span> cachedPromise = <span class="hljs-keyword">this</span>._promiseCache.get(cacheKey);
      <span class="hljs-keyword">if</span> (cachedPromise) {
        <span class="hljs-keyword">return</span> cachedPromise;
      }
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Otherwise, produce a new Promise for this value.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Enqueue this Promise to be dispatched.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      _this._queue.push({ <span class="hljs-attr">key</span>: key, <span class="hljs-attr">resolve</span>: resolve, <span class="hljs-attr">reject</span>: reject });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Determine if a dispatch of this queue should be scheduled.
A single dispatch should be scheduled per queue at the time when the
queue changes from &quot;empty&quot; to &quot;full&quot;.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (_this._queue.length === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">if</span> (shouldBatch) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>If batching, schedule a task to dispatch the queue.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          enqueuePostPromiseJob(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> dispatchQueue(_this);
          });
        } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Otherwise dispatch the (queue of one) immediately.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          dispatchQueue(_this);
        }
      }
    });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>If caching, cache this promise.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (shouldCache) {
      <span class="hljs-keyword">this</span>._promiseCache.set(cacheKey, promise);
    }

    <span class="hljs-keyword">return</span> promise;
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Loads multiple keys, promising an array of values:</p>
</div>
<div class="body">
<p>var [ a, b ] = await myLoader.loadMany([ 'a', 'b' ]);</p>
<p>This is equivalent to the more verbose:</p>
<pre><code>var [ a, b ] = await Promise.all([
  myLoader.load('a'),
  myLoader.load('b')
]);</code></pre>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">

  DataLoader.prototype.loadMany = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadMany</span>(<span class="hljs-params">keys</span>) </span>{
    <span class="hljs-keyword">var</span> _this2 = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(keys)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'The loader.loadMany() function must be called with Array&lt;key&gt; '</span> + (<span class="hljs-string">'but got: '</span> + keys + <span class="hljs-string">'.'</span>));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(keys.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
      <span class="hljs-keyword">return</span> _this2.load(key);
    }));
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<div class="dox">
<div class="summary">
<p>Clears the value at <code>key</code> from the cache, if it exists. Returns itself for
method chaining.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">

  DataLoader.prototype.clear = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clear</span>(<span class="hljs-params">key</span>) </span>{
    <span class="hljs-keyword">var</span> cacheKeyFn = <span class="hljs-keyword">this</span>._options &amp;&amp; <span class="hljs-keyword">this</span>._options.cacheKeyFn;
    <span class="hljs-keyword">var</span> cacheKey = cacheKeyFn ? cacheKeyFn(key) : key;
    <span class="hljs-keyword">this</span>._promiseCache.delete(cacheKey);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<div class="dox">
<div class="summary">
<p>Clears the entire cache. To be used when some event results in unknown
invalidations across this particular <code>DataLoader</code>. Returns itself for
method chaining.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">

  DataLoader.prototype.clearAll = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearAll</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._promiseCache.clear();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds the provided key and value to the cache. If the key already
exists, no change is made. Returns itself for method chaining.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">

  DataLoader.prototype.prime = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prime</span>(<span class="hljs-params">key, value</span>) </span>{
    <span class="hljs-keyword">var</span> cacheKeyFn = <span class="hljs-keyword">this</span>._options &amp;&amp; <span class="hljs-keyword">this</span>._options.cacheKeyFn;
    <span class="hljs-keyword">var</span> cacheKey = cacheKeyFn ? cacheKeyFn(key) : key;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Only add the key if it does not already exist.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._promiseCache.get(cacheKey) === <span class="hljs-literal">undefined</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Cache a rejected promise if the value is an Error, in order to match
the behavior of load(key).</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> promise = value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span> ? <span class="hljs-built_in">Promise</span>.reject(value) : <span class="hljs-built_in">Promise</span>.resolve(value);

      <span class="hljs-keyword">this</span>._promiseCache.set(cacheKey, promise);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

  <span class="hljs-keyword">return</span> DataLoader;
}();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>Private: Enqueue a Job to be executed after all &quot;PromiseJobs&quot; Jobs.</p>
<p>ES6 JavaScript uses the concepts Job and JobQueue to schedule work to occur
after the current execution context has completed:
http://www.ecma-international.org/ecma-262/6.0/#sec-jobs-and-job-queues</p>
<p>Node.js uses the <code>process.nextTick</code> mechanism to implement the concept of a
Job, maintaining a global FIFO JobQueue for all Jobs, which is flushed after
the current call stack ends.</p>
<p>When calling <code>then</code> on a Promise, it enqueues a Job on a specific
&quot;PromiseJobs&quot; JobQueue which is flushed in Node as a single Job on the
global JobQueue.</p>
<p>DataLoader batches all loads which occur in a single frame of execution, but
should include in the batch all loads which occur during the flushing of the
&quot;PromiseJobs&quot; JobQueue after that same execution frame.</p>
<p>In order to avoid the DataLoader dispatch Job occuring before &quot;PromiseJobs&quot;,
A Promise Job is created with the sole purpose of enqueuing a global Job,
ensuring that it always occurs after &quot;PromiseJobs&quot; ends.</p>
<p>Node.js's job queue is unique. Browsers do not have an equivalent mechanism
for enqueuing a job to be performed after promise microtasks and before the
next macrotask. For browser environments, a macrotask is used (via
setImmediate or setTimeout) at a potential performance penalty.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>If a custom cache is provided, it must be of this type (a subset of ES6 Map).</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<div class="dox">
<div class="summary">
<p>Copyright (c) 2015, Facebook, Inc.
All rights reserved.</p>
</div>
<div class="body">
<p>This source code is licensed under the BSD-style license found in the
LICENSE file in the root directory of this source tree. An additional grant
of patent rights can be found in the PATENTS file in the same directory.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>A Function, which when given an Array of keys, returns a Promise of an Array
of values or Errors.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">

<span class="hljs-keyword">var</span> enqueuePostPromiseJob = <span class="hljs-keyword">typeof</span> process === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> process.nextTick === <span class="hljs-string">'function'</span> ? <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
  <span class="hljs-keyword">if</span> (!resolvedPromise) {
    resolvedPromise = <span class="hljs-built_in">Promise</span>.resolve();
  }
  resolvedPromise.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> process.nextTick(fn);
  });
} : setImmediate || setTimeout;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Private: cached resolved Promise instance</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> resolvedPromise;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Private: given the current state of a Loader instance, perform a batch load
from its current queue.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dispatchQueue</span>(<span class="hljs-params">loader</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>Take the current loader queue, replacing it with an empty queue.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> queue = loader._queue;
  loader._queue = [];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>If a maxBatchSize was provided and the queue is longer, then segment the
queue into multiple batches, otherwise treat the queue as a single batch.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> maxBatchSize = loader._options &amp;&amp; loader._options.maxBatchSize;
  <span class="hljs-keyword">if</span> (maxBatchSize &amp;&amp; maxBatchSize &gt; <span class="hljs-number">0</span> &amp;&amp; maxBatchSize &lt; queue.length) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; queue.length / maxBatchSize; i++) {
      dispatchQueueBatch(loader, queue.slice(i * maxBatchSize, (i + <span class="hljs-number">1</span>) * maxBatchSize));
    }
  } <span class="hljs-keyword">else</span> {
    dispatchQueueBatch(loader, queue);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dispatchQueueBatch</span>(<span class="hljs-params">loader, queue</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>Collect all keys to be loaded in this dispatch</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> keys = queue.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_ref</span>) </span>{
    <span class="hljs-keyword">var</span> key = _ref.key;
    <span class="hljs-keyword">return</span> key;
  });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>Call the provided batchLoadFn for this loader with the loader queue's keys.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> batchLoadFn = loader._batchLoadFn;
  <span class="hljs-keyword">var</span> batchPromise = batchLoadFn(keys);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Assert the expected response from batchLoadFn</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!batchPromise || <span class="hljs-keyword">typeof</span> batchPromise.then !== <span class="hljs-string">'function'</span>) {
    <span class="hljs-keyword">return</span> failedDispatch(loader, queue, <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'DataLoader must be constructed with a function which accepts '</span> + <span class="hljs-string">'Array&lt;key&gt; and returns Promise&lt;Array&lt;value&gt;&gt;, but the function did '</span> + (<span class="hljs-string">'not return a Promise: '</span> + <span class="hljs-built_in">String</span>(batchPromise) + <span class="hljs-string">'.'</span>)));
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Await the resolution of the call to batchLoadFn.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  batchPromise.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">values</span>) </span>{

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Assert the expected resolution from batchLoadFn.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(values)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'DataLoader must be constructed with a function which accepts '</span> + <span class="hljs-string">'Array&lt;key&gt; and returns Promise&lt;Array&lt;value&gt;&gt;, but the function did '</span> + (<span class="hljs-string">'not return a Promise of an Array: '</span> + <span class="hljs-built_in">String</span>(values) + <span class="hljs-string">'.'</span>));
    }
    <span class="hljs-keyword">if</span> (values.length !== keys.length) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'DataLoader must be constructed with a function which accepts '</span> + <span class="hljs-string">'Array&lt;key&gt; and returns Promise&lt;Array&lt;value&gt;&gt;, but the function did '</span> + <span class="hljs-string">'not return a Promise of an Array of the same length as the Array '</span> + <span class="hljs-string">'of keys.'</span> + (<span class="hljs-string">'\n\nKeys:\n'</span> + <span class="hljs-built_in">String</span>(keys)) + (<span class="hljs-string">'\n\nValues:\n'</span> + <span class="hljs-built_in">String</span>(values)));
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>Step through the values, resolving or rejecting each Promise in the
loaded queue.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    queue.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_ref2, index</span>) </span>{
      <span class="hljs-keyword">var</span> resolve = _ref2.resolve,
          reject = _ref2.reject;

      <span class="hljs-keyword">var</span> value = values[index];
      <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) {
        reject(value);
      } <span class="hljs-keyword">else</span> {
        resolve(value);
      }
    });
  }).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>{
    <span class="hljs-keyword">return</span> failedDispatch(loader, queue, error);
  });
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>Private: do not cache individual loads if the entire batch dispatch fails,
but still reject each request so they do not hang.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failedDispatch</span>(<span class="hljs-params">loader, queue, error</span>) </span>{
  queue.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_ref3</span>) </span>{
    <span class="hljs-keyword">var</span> key = _ref3.key,
        reject = _ref3.reject;

    loader.clear(key);
    reject(error);
  });
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>Private: given the DataLoader's options, produce a CacheMap to be used.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getValidCacheMap</span>(<span class="hljs-params">options</span>) </span>{
  <span class="hljs-keyword">var</span> cacheMap = options &amp;&amp; options.cacheMap;
  <span class="hljs-keyword">if</span> (!cacheMap) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>();
  }
  <span class="hljs-keyword">var</span> cacheFunctions = [<span class="hljs-string">'get'</span>, <span class="hljs-string">'set'</span>, <span class="hljs-string">'delete'</span>, <span class="hljs-string">'clear'</span>];
  <span class="hljs-keyword">var</span> missingFunctions = cacheFunctions.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fnName</span>) </span>{
    <span class="hljs-keyword">return</span> cacheMap &amp;&amp; <span class="hljs-keyword">typeof</span> cacheMap[fnName] !== <span class="hljs-string">'function'</span>;
  });
  <span class="hljs-keyword">if</span> (missingFunctions.length !== <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Custom cacheMap missing methods: '</span> + missingFunctions.join(<span class="hljs-string">', '</span>));
  }
  <span class="hljs-keyword">return</span> cacheMap;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>Private</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">

<span class="hljs-built_in">module</span>.exports = DataLoader;
</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
