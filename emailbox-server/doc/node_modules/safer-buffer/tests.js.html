<!DOCTYPE html>
<html>
<head>
  <title>tests.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\safer-buffer\\tests.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>tests.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>eslint-disable node/no-deprecated-api</p>
</div>
<div class="body">
<p>'use strict'</p>
<p>var test = require('tape')</p>
<p>var buffer = require('buffer')</p>
<p>var index = require('./')
var safer = require('./safer')
var dangerous = require('./dangerous')</p>
<p>/* Inheritance tests */</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
test(<span class="hljs-string">'Default is Safer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  t.equal(index, safer)
  t.notEqual(safer, dangerous)
  t.notEqual(index, dangerous)
  t.end()
})

test(<span class="hljs-string">'Is not a function'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.equal(<span class="hljs-keyword">typeof</span> impl, <span class="hljs-string">'object'</span>)
    t.equal(<span class="hljs-keyword">typeof</span> impl.Buffer, <span class="hljs-string">'object'</span>)
  });
  [buffer].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.equal(<span class="hljs-keyword">typeof</span> impl, <span class="hljs-string">'object'</span>)
    t.equal(<span class="hljs-keyword">typeof</span> impl.Buffer, <span class="hljs-string">'function'</span>)
  })
  t.end()
})

test(<span class="hljs-string">'Constructor throws'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer() })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer(<span class="hljs-number">0</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer(<span class="hljs-string">'a'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer(<span class="hljs-string">'a'</span>, <span class="hljs-string">'utf-8'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> impl.Buffer() })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> impl.Buffer(<span class="hljs-number">0</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> impl.Buffer(<span class="hljs-string">'a'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> impl.Buffer(<span class="hljs-string">'a'</span>, <span class="hljs-string">'utf-8'</span>) })
  })
  t.end()
})

test(<span class="hljs-string">'Safe methods exist'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.equal(<span class="hljs-keyword">typeof</span> impl.Buffer.alloc, <span class="hljs-string">'function'</span>, <span class="hljs-string">'alloc'</span>)
    t.equal(<span class="hljs-keyword">typeof</span> impl.Buffer.from, <span class="hljs-string">'function'</span>, <span class="hljs-string">'from'</span>)
  })
  t.end()
})

test(<span class="hljs-string">'Unsafe methods exist only in Dangerous'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.equal(<span class="hljs-keyword">typeof</span> impl.Buffer.allocUnsafe, <span class="hljs-string">'undefined'</span>)
    t.equal(<span class="hljs-keyword">typeof</span> impl.Buffer.allocUnsafeSlow, <span class="hljs-string">'undefined'</span>)
  });
  [dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.equal(<span class="hljs-keyword">typeof</span> impl.Buffer.allocUnsafe, <span class="hljs-string">'function'</span>)
    t.equal(<span class="hljs-keyword">typeof</span> impl.Buffer.allocUnsafeSlow, <span class="hljs-string">'function'</span>)
  })
  t.end()
})

test(<span class="hljs-string">'Generic methods/properties are defined and equal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [<span class="hljs-string">'poolSize'</span>, <span class="hljs-string">'isBuffer'</span>, <span class="hljs-string">'concat'</span>, <span class="hljs-string">'byteLength'</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
      t.equal(impl.Buffer[method], buffer.Buffer[method], method)
      t.notEqual(<span class="hljs-keyword">typeof</span> impl.Buffer[method], <span class="hljs-string">'undefined'</span>, method)
    })
  })
  t.end()
})

test(<span class="hljs-string">'Built-in buffer static methods/properties are inherited'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  <span class="hljs-built_in">Object</span>.keys(buffer).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'SlowBuffer'</span> || method === <span class="hljs-string">'Buffer'</span>) <span class="hljs-keyword">return</span>;
    [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
      t.equal(impl[method], buffer[method], method)
      t.notEqual(<span class="hljs-keyword">typeof</span> impl[method], <span class="hljs-string">'undefined'</span>, method)
    })
  })
  t.end()
})

test(<span class="hljs-string">'Built-in Buffer static methods/properties are inherited'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  <span class="hljs-built_in">Object</span>.keys(buffer.Buffer).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'allocUnsafe'</span> || method === <span class="hljs-string">'allocUnsafeSlow'</span>) <span class="hljs-keyword">return</span>;
    [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
      t.equal(impl.Buffer[method], buffer.Buffer[method], method)
      t.notEqual(<span class="hljs-keyword">typeof</span> impl.Buffer[method], <span class="hljs-string">'undefined'</span>, method)
    })
  })
  t.end()
})

test(<span class="hljs-string">'.prototype property of Buffer is inherited'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.equal(impl.Buffer.prototype, buffer.Buffer.prototype, <span class="hljs-string">'prototype'</span>)
    t.notEqual(<span class="hljs-keyword">typeof</span> impl.Buffer.prototype, <span class="hljs-string">'undefined'</span>, <span class="hljs-string">'prototype'</span>)
  })
  t.end()
})

test(<span class="hljs-string">'All Safer methods are present in Dangerous'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  <span class="hljs-built_in">Object</span>.keys(safer).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'Buffer'</span>) <span class="hljs-keyword">return</span>;
    [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
      t.equal(impl[method], safer[method], method)
      <span class="hljs-keyword">if</span> (method !== <span class="hljs-string">'kStringMaxLength'</span>) {
        t.notEqual(<span class="hljs-keyword">typeof</span> impl[method], <span class="hljs-string">'undefined'</span>, method)
      }
    })
  })
  <span class="hljs-built_in">Object</span>.keys(safer.Buffer).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
      t.equal(impl.Buffer[method], safer.Buffer[method], method)
      t.notEqual(<span class="hljs-keyword">typeof</span> impl.Buffer[method], <span class="hljs-string">'undefined'</span>, method)
    })
  })
  t.end()
})

test(<span class="hljs-string">'Safe methods from Dangerous methods are present in Safer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  <span class="hljs-built_in">Object</span>.keys(dangerous).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'Buffer'</span>) <span class="hljs-keyword">return</span>;
    [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
      t.equal(impl[method], dangerous[method], method)
      <span class="hljs-keyword">if</span> (method !== <span class="hljs-string">'kStringMaxLength'</span>) {
        t.notEqual(<span class="hljs-keyword">typeof</span> impl[method], <span class="hljs-string">'undefined'</span>, method)
      }
    })
  })
  <span class="hljs-built_in">Object</span>.keys(dangerous.Buffer).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'allocUnsafe'</span> || method === <span class="hljs-string">'allocUnsafeSlow'</span>) <span class="hljs-keyword">return</span>;
    [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
      t.equal(impl.Buffer[method], dangerous.Buffer[method], method)
      t.notEqual(<span class="hljs-keyword">typeof</span> impl.Buffer[method], <span class="hljs-string">'undefined'</span>, method)
    })
  })
  t.end()
})

<span class="hljs-comment">/* Behaviour tests */</span>

test(<span class="hljs-string">'Methods return Buffers'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.alloc(<span class="hljs-number">0</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.alloc(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.alloc(<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.alloc(<span class="hljs-number">10</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.alloc(<span class="hljs-number">10</span>, <span class="hljs-string">'x'</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.alloc(<span class="hljs-number">9</span>, <span class="hljs-string">'ab'</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.from(<span class="hljs-string">''</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.from(<span class="hljs-string">'string'</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.from(<span class="hljs-string">'string'</span>, <span class="hljs-string">'utf-8'</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.from(<span class="hljs-string">'b25ldHdvdGhyZWU='</span>, <span class="hljs-string">'base64'</span>)))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.from([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>])))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.from(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>]))))
    t.ok(buffer.Buffer.isBuffer(impl.Buffer.from([])))
  });
  [<span class="hljs-string">'allocUnsafe'</span>, <span class="hljs-string">'allocUnsafeSlow'</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    t.ok(buffer.Buffer.isBuffer(dangerous.Buffer[method](<span class="hljs-number">0</span>)))
    t.ok(buffer.Buffer.isBuffer(dangerous.Buffer[method](<span class="hljs-number">10</span>)))
  })
  t.end()
})

test(<span class="hljs-string">'Constructor is buffer.Buffer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.equal(impl.Buffer.alloc(<span class="hljs-number">0</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.alloc(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.alloc(<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.alloc(<span class="hljs-number">10</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.alloc(<span class="hljs-number">10</span>, <span class="hljs-string">'x'</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.alloc(<span class="hljs-number">9</span>, <span class="hljs-string">'ab'</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.from(<span class="hljs-string">''</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.from(<span class="hljs-string">'string'</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.from(<span class="hljs-string">'string'</span>, <span class="hljs-string">'utf-8'</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.from(<span class="hljs-string">'b25ldHdvdGhyZWU='</span>, <span class="hljs-string">'base64'</span>).constructor, buffer.Buffer)
    t.equal(impl.Buffer.from([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>]).constructor, buffer.Buffer)
    t.equal(impl.Buffer.from(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>])).constructor, buffer.Buffer)
    t.equal(impl.Buffer.from([]).constructor, buffer.Buffer)
  });
  [<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
    t.equal(dangerous.Buffer.allocUnsafe(arg).constructor, buffer.Buffer)
    t.equal(dangerous.Buffer.allocUnsafeSlow(arg).constructor, buffer.SlowBuffer(<span class="hljs-number">0</span>).constructor)
  })
  t.end()
})

test(<span class="hljs-string">'Invalid calls throw'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-number">0</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-number">10</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-number">10</span>, <span class="hljs-string">'utf-8'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-string">'string'</span>, <span class="hljs-string">'invalid encoding'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-number">-10</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-number">1e90</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-literal">Infinity</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(-<span class="hljs-literal">Infinity</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-literal">NaN</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-literal">null</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from(<span class="hljs-literal">undefined</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from() })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.from({}) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-string">''</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-string">'string'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-string">'string'</span>, <span class="hljs-string">'utf-8'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-string">'b25ldHdvdGhyZWU='</span>, <span class="hljs-string">'base64'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-number">-10</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-number">1e90</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-number">2</span> * (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>)) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-literal">Infinity</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(-<span class="hljs-literal">Infinity</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-literal">null</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc(<span class="hljs-literal">undefined</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc() })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc([]) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>]) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ impl.Buffer.alloc({}) })
  });
  [<span class="hljs-string">'allocUnsafe'</span>, <span class="hljs-string">'allocUnsafeSlow'</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](<span class="hljs-string">''</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](<span class="hljs-string">'string'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](<span class="hljs-string">'string'</span>, <span class="hljs-string">'utf-8'</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](<span class="hljs-number">2</span> * (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>)) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](<span class="hljs-literal">Infinity</span>) })
    <span class="hljs-keyword">if</span> (dangerous.Buffer[method] === buffer.Buffer.allocUnsafe) {
      t.skip(<span class="hljs-string">'Skipping, older impl of allocUnsafe coerced negative sizes to 0'</span>)
    } <span class="hljs-keyword">else</span> {
      t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](<span class="hljs-number">-10</span>) })
      t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](<span class="hljs-number">-1e90</span>) })
      t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](-<span class="hljs-literal">Infinity</span>) })
    }
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](<span class="hljs-literal">null</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method](<span class="hljs-literal">undefined</span>) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method]() })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method]([]) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method]([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>]) })
    t.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ dangerous.Buffer[method]({}) })
  })
  t.end()
})

test(<span class="hljs-string">'Buffers have appropriate lengths'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.equal(impl.Buffer.alloc(<span class="hljs-number">0</span>).length, <span class="hljs-number">0</span>)
    t.equal(impl.Buffer.alloc(<span class="hljs-number">10</span>).length, <span class="hljs-number">10</span>)
    t.equal(impl.Buffer.from(<span class="hljs-string">''</span>).length, <span class="hljs-number">0</span>)
    t.equal(impl.Buffer.from(<span class="hljs-string">'string'</span>).length, <span class="hljs-number">6</span>)
    t.equal(impl.Buffer.from(<span class="hljs-string">'string'</span>, <span class="hljs-string">'utf-8'</span>).length, <span class="hljs-number">6</span>)
    t.equal(impl.Buffer.from(<span class="hljs-string">'b25ldHdvdGhyZWU='</span>, <span class="hljs-string">'base64'</span>).length, <span class="hljs-number">11</span>)
    t.equal(impl.Buffer.from([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>]).length, <span class="hljs-number">3</span>)
    t.equal(impl.Buffer.from(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>])).length, <span class="hljs-number">3</span>)
    t.equal(impl.Buffer.from([]).length, <span class="hljs-number">0</span>)
  });
  [<span class="hljs-string">'allocUnsafe'</span>, <span class="hljs-string">'allocUnsafeSlow'</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    t.equal(dangerous.Buffer[method](<span class="hljs-number">0</span>).length, <span class="hljs-number">0</span>)
    t.equal(dangerous.Buffer[method](<span class="hljs-number">10</span>).length, <span class="hljs-number">10</span>)
  })
  t.end()
})

test(<span class="hljs-string">'Buffers have appropriate lengths (2)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  t.equal(index.Buffer.alloc, safer.Buffer.alloc)
  t.equal(index.Buffer.alloc, dangerous.Buffer.alloc)
  <span class="hljs-keyword">var</span> ok = <span class="hljs-literal">true</span>;
  [ safer.Buffer.alloc,
    dangerous.Buffer.allocUnsafe,
    dangerous.Buffer.allocUnsafeSlow
  ].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e2</span>; i++) {
      <span class="hljs-keyword">var</span> length = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">1e5</span>)
      <span class="hljs-keyword">var</span> buf = method(length)
      <span class="hljs-keyword">if</span> (!buffer.Buffer.isBuffer(buf)) ok = <span class="hljs-literal">false</span>
      <span class="hljs-keyword">if</span> (buf.length !== length) ok = <span class="hljs-literal">false</span>
    }
  })
  t.ok(ok)
  t.end()
})

test(<span class="hljs-string">'.alloc(size) is zero-filled and has correct length'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  t.equal(index.Buffer.alloc, safer.Buffer.alloc)
  t.equal(index.Buffer.alloc, dangerous.Buffer.alloc)
  <span class="hljs-keyword">var</span> ok = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e2</span>; i++) {
    <span class="hljs-keyword">var</span> length = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">2e6</span>)
    <span class="hljs-keyword">var</span> buf = index.Buffer.alloc(length)
    <span class="hljs-keyword">if</span> (!buffer.Buffer.isBuffer(buf)) ok = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">if</span> (buf.length !== length) ok = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> j
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; length; j++) {
      <span class="hljs-keyword">if</span> (buf[j] !== <span class="hljs-number">0</span>) ok = <span class="hljs-literal">false</span>
    }
    buf.fill(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; length; j++) {
      <span class="hljs-keyword">if</span> (buf[j] !== <span class="hljs-number">1</span>) ok = <span class="hljs-literal">false</span>
    }
  }
  t.ok(ok)
  t.end()
})

test(<span class="hljs-string">'.allocUnsafe / .allocUnsafeSlow are fillable and have correct lengths'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [<span class="hljs-string">'allocUnsafe'</span>, <span class="hljs-string">'allocUnsafeSlow'</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{
    <span class="hljs-keyword">var</span> ok = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e2</span>; i++) {
      <span class="hljs-keyword">var</span> length = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">2e6</span>)
      <span class="hljs-keyword">var</span> buf = dangerous.Buffer[method](length)
      <span class="hljs-keyword">if</span> (!buffer.Buffer.isBuffer(buf)) ok = <span class="hljs-literal">false</span>
      <span class="hljs-keyword">if</span> (buf.length !== length) ok = <span class="hljs-literal">false</span>
      buf.fill(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, length)
      <span class="hljs-keyword">var</span> j
      <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; length; j++) {
        <span class="hljs-keyword">if</span> (buf[j] !== <span class="hljs-number">0</span>) ok = <span class="hljs-literal">false</span>
      }
      buf.fill(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, length)
      <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; length; j++) {
        <span class="hljs-keyword">if</span> (buf[j] !== <span class="hljs-number">1</span>) ok = <span class="hljs-literal">false</span>
      }
    }
    t.ok(ok, method)
  })
  t.end()
})

test(<span class="hljs-string">'.alloc(size, fill) is `fill`-filled'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  t.equal(index.Buffer.alloc, safer.Buffer.alloc)
  t.equal(index.Buffer.alloc, dangerous.Buffer.alloc)
  <span class="hljs-keyword">var</span> ok = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e2</span>; i++) {
    <span class="hljs-keyword">var</span> length = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">2e6</span>)
    <span class="hljs-keyword">var</span> fill = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">255</span>)
    <span class="hljs-keyword">var</span> buf = index.Buffer.alloc(length, fill)
    <span class="hljs-keyword">if</span> (!buffer.Buffer.isBuffer(buf)) ok = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">if</span> (buf.length !== length) ok = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; length; j++) {
      <span class="hljs-keyword">if</span> (buf[j] !== fill) ok = <span class="hljs-literal">false</span>
    }
  }
  t.ok(ok)
  t.end()
})

test(<span class="hljs-string">'.alloc(size, fill) is `fill`-filled'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  t.equal(index.Buffer.alloc, safer.Buffer.alloc)
  t.equal(index.Buffer.alloc, dangerous.Buffer.alloc)
  <span class="hljs-keyword">var</span> ok = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e2</span>; i++) {
    <span class="hljs-keyword">var</span> length = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">2e6</span>)
    <span class="hljs-keyword">var</span> fill = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">255</span>)
    <span class="hljs-keyword">var</span> buf = index.Buffer.alloc(length, fill)
    <span class="hljs-keyword">if</span> (!buffer.Buffer.isBuffer(buf)) ok = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">if</span> (buf.length !== length) ok = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; length; j++) {
      <span class="hljs-keyword">if</span> (buf[j] !== fill) ok = <span class="hljs-literal">false</span>
    }
  }
  t.ok(ok)
  t.deepEqual(index.Buffer.alloc(<span class="hljs-number">9</span>, <span class="hljs-string">'a'</span>), index.Buffer.alloc(<span class="hljs-number">9</span>, <span class="hljs-number">97</span>))
  t.notDeepEqual(index.Buffer.alloc(<span class="hljs-number">9</span>, <span class="hljs-string">'a'</span>), index.Buffer.alloc(<span class="hljs-number">9</span>, <span class="hljs-number">98</span>))

  <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">new</span> buffer.Buffer(<span class="hljs-number">2</span>)
  tmp.fill(<span class="hljs-string">'ok'</span>)
  <span class="hljs-keyword">if</span> (tmp[<span class="hljs-number">1</span>] === tmp[<span class="hljs-number">0</span>]) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Outdated Node.js</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    t.deepEqual(index.Buffer.alloc(<span class="hljs-number">5</span>, <span class="hljs-string">'ok'</span>), index.Buffer.from(<span class="hljs-string">'ooooo'</span>))
  } <span class="hljs-keyword">else</span> {
    t.deepEqual(index.Buffer.alloc(<span class="hljs-number">5</span>, <span class="hljs-string">'ok'</span>), index.Buffer.from(<span class="hljs-string">'okoko'</span>))
  }
  t.notDeepEqual(index.Buffer.alloc(<span class="hljs-number">5</span>, <span class="hljs-string">'ok'</span>), index.Buffer.from(<span class="hljs-string">'kokok'</span>))

  t.end()
})

test(<span class="hljs-string">'safer.Buffer.from returns results same as Buffer constructor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.deepEqual(impl.Buffer.from(<span class="hljs-string">''</span>), <span class="hljs-keyword">new</span> buffer.Buffer(<span class="hljs-string">''</span>))
    t.deepEqual(impl.Buffer.from(<span class="hljs-string">'string'</span>), <span class="hljs-keyword">new</span> buffer.Buffer(<span class="hljs-string">'string'</span>))
    t.deepEqual(impl.Buffer.from(<span class="hljs-string">'string'</span>, <span class="hljs-string">'utf-8'</span>), <span class="hljs-keyword">new</span> buffer.Buffer(<span class="hljs-string">'string'</span>, <span class="hljs-string">'utf-8'</span>))
    t.deepEqual(impl.Buffer.from(<span class="hljs-string">'b25ldHdvdGhyZWU='</span>, <span class="hljs-string">'base64'</span>), <span class="hljs-keyword">new</span> buffer.Buffer(<span class="hljs-string">'b25ldHdvdGhyZWU='</span>, <span class="hljs-string">'base64'</span>))
    t.deepEqual(impl.Buffer.from([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>]), <span class="hljs-keyword">new</span> buffer.Buffer([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>]))
    t.deepEqual(impl.Buffer.from(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>])), <span class="hljs-keyword">new</span> buffer.Buffer(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">3</span>])))
    t.deepEqual(impl.Buffer.from([]), <span class="hljs-keyword">new</span> buffer.Buffer([]))
  })
  t.end()
})

test(<span class="hljs-string">'safer.Buffer.from returns consistent results'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  [index, safer, dangerous].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">impl</span>) </span>{
    t.deepEqual(impl.Buffer.from(<span class="hljs-string">''</span>), impl.Buffer.alloc(<span class="hljs-number">0</span>))
    t.deepEqual(impl.Buffer.from([]), impl.Buffer.alloc(<span class="hljs-number">0</span>))
    t.deepEqual(impl.Buffer.from(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([])), impl.Buffer.alloc(<span class="hljs-number">0</span>))
    t.deepEqual(impl.Buffer.from(<span class="hljs-string">'string'</span>, <span class="hljs-string">'utf-8'</span>), impl.Buffer.from(<span class="hljs-string">'string'</span>))
    t.deepEqual(impl.Buffer.from(<span class="hljs-string">'string'</span>), impl.Buffer.from([<span class="hljs-number">115</span>, <span class="hljs-number">116</span>, <span class="hljs-number">114</span>, <span class="hljs-number">105</span>, <span class="hljs-number">110</span>, <span class="hljs-number">103</span>]))
    t.deepEqual(impl.Buffer.from(<span class="hljs-string">'string'</span>), impl.Buffer.from(impl.Buffer.from(<span class="hljs-string">'string'</span>)))
    t.deepEqual(impl.Buffer.from(<span class="hljs-string">'b25ldHdvdGhyZWU='</span>, <span class="hljs-string">'base64'</span>), impl.Buffer.from(<span class="hljs-string">'onetwothree'</span>))
    t.notDeepEqual(impl.Buffer.from(<span class="hljs-string">'b25ldHdvdGhyZWU='</span>), impl.Buffer.from(<span class="hljs-string">'onetwothree'</span>))
  })
  t.end()
})

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
