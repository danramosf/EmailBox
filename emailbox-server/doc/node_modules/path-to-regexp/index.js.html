<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\path-to-regexp\\index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>Expose <code>pathtoRegexp</code>.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">module</span>.exports = pathtoRegexp;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Match matching groups in a regular expression.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> MATCHING_GROUP_REGEXP = <span class="hljs-regexp">/\((?!\?)/g</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Normalize the given path string,
returning a regular expression.</p>
</div>
<div class="body">
<p>An empty array should be passed,
which will contain the placeholder
key names. For example &quot;/user/:id&quot; will
then contain [&quot;id&quot;].</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
<span class="dox_type">RegExp</span>
<span class="dox_type">Array</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">keys</span>
<span class="dox_type">Array</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">RegExp</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pathtoRegexp</span>(<span class="hljs-params">path, keys, options</span>) </span>{
  options = options || {};
  keys = keys || [];
  <span class="hljs-keyword">var</span> strict = options.strict;
  <span class="hljs-keyword">var</span> end = options.end !== <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> flags = options.sensitive ? <span class="hljs-string">''</span> : <span class="hljs-string">'i'</span>;
  <span class="hljs-keyword">var</span> extraOffset = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> keysOffset = keys.length;
  <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> name = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> m;

  <span class="hljs-keyword">if</span> (path <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) {
    <span class="hljs-keyword">while</span> (m = MATCHING_GROUP_REGEXP.exec(path.source)) {
      keys.push({
        <span class="hljs-attr">name</span>: name++,
        <span class="hljs-attr">optional</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">offset</span>: m.index
      });
    }

    <span class="hljs-keyword">return</span> path;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(path)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Map array parts into regexps and return their source. We also pass
the same keys and options instance into every generation to get
consistent matching groups before we join the sources together.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    path = path.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
      <span class="hljs-keyword">return</span> pathtoRegexp(value, keys, options).source;
    });

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'(?:'</span> + path.join(<span class="hljs-string">'|'</span>) + <span class="hljs-string">')'</span>, flags);
  }

  path = (<span class="hljs-string">'^'</span> + path + (strict ? <span class="hljs-string">''</span> : path[path.length - <span class="hljs-number">1</span>] === <span class="hljs-string">'/'</span> ? <span class="hljs-string">'?'</span> : <span class="hljs-string">'/?'</span>))
    .replace(<span class="hljs-regexp">/\/\(/g</span>, <span class="hljs-string">'/(?:'</span>)
    .replace(<span class="hljs-regexp">/([\/\.])/g</span>, <span class="hljs-string">'\\$1'</span>)
    .replace(<span class="hljs-regexp">/(\\\/)?(\\\.)?:(\w+)(\(.*?\))?(\*)?(\?)?/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">match, slash, format, key, capture, star, optional, offset</span>) </span>{
      slash = slash || <span class="hljs-string">''</span>;
      format = format || <span class="hljs-string">''</span>;
      capture = capture || <span class="hljs-string">'([^\\/'</span> + format + <span class="hljs-string">']+?)'</span>;
      optional = optional || <span class="hljs-string">''</span>;

      keys.push({
        <span class="hljs-attr">name</span>: key,
        <span class="hljs-attr">optional</span>: !!optional,
        <span class="hljs-attr">offset</span>: offset + extraOffset
      });

      <span class="hljs-keyword">var</span> result = <span class="hljs-string">''</span>
        + (optional ? <span class="hljs-string">''</span> : slash)
        + <span class="hljs-string">'(?:'</span>
        + format + (optional ? slash : <span class="hljs-string">''</span>) + capture
        + (star ? <span class="hljs-string">'((?:[\\/'</span> + format + <span class="hljs-string">'].+?)?)'</span> : <span class="hljs-string">''</span>)
        + <span class="hljs-string">')'</span>
        + optional;

      extraOffset += result.length - match.length;

      <span class="hljs-keyword">return</span> result;
    })
    .replace(<span class="hljs-regexp">/\*/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">star, index</span>) </span>{
      <span class="hljs-keyword">var</span> len = keys.length

      <span class="hljs-keyword">while</span> (len-- &gt; keysOffset &amp;&amp; keys[len].offset &gt; index) {
        keys[len].offset += <span class="hljs-number">3</span>; <span class="hljs-comment">// Replacement length minus asterisk length.</span>
      }

      <span class="hljs-keyword">return</span> <span class="hljs-string">'(.*)'</span>;
    });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>This is a workaround for handling unnamed matching groups.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">while</span> (m = MATCHING_GROUP_REGEXP.exec(path)) {
    <span class="hljs-keyword">var</span> escapeCount = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> index = m.index;

    <span class="hljs-keyword">while</span> (path.charAt(--index) === <span class="hljs-string">'\\'</span>) {
      escapeCount++;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>It's possible to escape the bracket.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (escapeCount % <span class="hljs-number">2</span> === <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-keyword">if</span> (keysOffset + i === keys.length || keys[keysOffset + i].offset &gt; m.index) {
      keys.splice(keysOffset + i, <span class="hljs-number">0</span>, {
        <span class="hljs-attr">name</span>: name++, <span class="hljs-comment">// Unnamed matching groups must be consistently linear.</span>
        optional: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">offset</span>: m.index
      });
    }

    i++;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>If the path is non-ending, match until the end or a slash.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  path += (end ? <span class="hljs-string">'$'</span> : (path[path.length - <span class="hljs-number">1</span>] === <span class="hljs-string">'/'</span> ? <span class="hljs-string">''</span> : <span class="hljs-string">'(?=\\/|$)'</span>));

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(path, flags);
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
