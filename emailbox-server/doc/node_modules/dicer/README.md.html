<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\dicer\\README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#description">Description</a>
      </div>

      <div class="heading h1">
        <a href="#requirements">Requirements</a>
      </div>

      <div class="heading h1">
        <a href="#install">Install</a>
      </div>

      <div class="heading h1">
        <a href="#examples">Examples</a>
      </div>

      <div class="heading h1">
        <a href="#api">API</a>
      </div>

      <div class="heading h2">
        <a href="#dicer-special-events">Dicer (special) events</a>
      </div>

      <div class="heading h2">
        <a href="#dicer-methods">Dicer methods</a>
      </div>

      <div class="heading h2">
        <a href="#partstream-special-events">PartStream (special) events</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="description">
  <h1>
    <a href="#description" name="description" class="pilcrow"></a>
Description
  </h1>
</div>
<p>A very fast streaming multipart parser for node.js.</p>
<p>Benchmarks can be found <a href="https://github.com/mscdex/dicer/wiki/Benchmarks">here</a>.</p>
<div class="pilwrap" id="requirements">
  <h1>
    <a href="#requirements" name="requirements" class="pilcrow"></a>
Requirements
  </h1>
</div>
<ul>
<li><a href="http://nodejs.org/">node.js</a> -- v0.8.0 or newer</li>
</ul>
<div class="pilwrap" id="install">
  <h1>
    <a href="#install" name="install" class="pilcrow"></a>
Install
  </h1>
</div>
<pre><code>npm install dicer
</code></pre>
<div class="pilwrap" id="examples">
  <h1>
    <a href="#examples" name="examples" class="pilcrow"></a>
Examples
  </h1>
</div>
<ul>
<li>Parse an HTTP form upload</li>
</ul>
<pre><code class="javascript"><span class="hljs-keyword">var</span> inspect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>).inspect,
    http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">var</span> Dicer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'dicer'</span>);

    <span class="hljs-comment">// quick and dirty way to parse multipart boundary</span>
<span class="hljs-keyword">var</span> RE_BOUNDARY = <span class="hljs-regexp">/^multipart\/.+?(?:; boundary=(?:(?:"(.+)")|(?:([^\s]+))))$/i</span>,
    HTML = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">'&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;\
                       &lt;form method="POST" enctype="multipart/form-data"&gt;\
                         &lt;input type="text" name="textfield"&gt;&lt;br /&gt;\
                         &lt;input type="file" name="filefield"&gt;&lt;br /&gt;\
                         &lt;input type="submit"&gt;\
                       &lt;/form&gt;\
                       &lt;/body&gt;&lt;/html&gt;'</span>),
    PORT = <span class="hljs-number">8080</span>;

http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">var</span> m;
  <span class="hljs-keyword">if</span> (req.method === <span class="hljs-string">'POST'</span>
      &amp;&amp; req.headers[<span class="hljs-string">'content-type'</span>]
      &amp;&amp; (m = RE_BOUNDARY.exec(req.headers[<span class="hljs-string">'content-type'</span>]))) {
    <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> Dicer({ <span class="hljs-attr">boundary</span>: m[<span class="hljs-number">1</span>] || m[<span class="hljs-number">2</span>] });

    d.on(<span class="hljs-string">'part'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p</span>) </span>{
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'New part!'</span>);
      p.on(<span class="hljs-string">'header'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">header</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> h <span class="hljs-keyword">in</span> header) {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Part header: k: '</span> + inspect(h)
                      + <span class="hljs-string">', v: '</span> + inspect(header[h]));
        }
      });
      p.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Part data: '</span> + inspect(data.toString()));
      });
      p.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'End of part\n'</span>);
      });
    });
    d.on(<span class="hljs-string">'finish'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'End of parts'</span>);
      res.writeHead(<span class="hljs-number">200</span>);
      res.end(<span class="hljs-string">'Form submission successful!'</span>);
    });
    req.pipe(d);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.method === <span class="hljs-string">'GET'</span> &amp;&amp; req.url === <span class="hljs-string">'/'</span>) {
    res.writeHead(<span class="hljs-number">200</span>);
    res.end(HTML);
  } <span class="hljs-keyword">else</span> {
    res.writeHead(<span class="hljs-number">404</span>);
    res.end();
  }
}).listen(PORT, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Listening for requests on port '</span> + PORT);
});
</code></pre>
<div class="pilwrap" id="api">
  <h1>
    <a href="#api" name="api" class="pilcrow"></a>
API
  </h1>
</div>
<p><em>Dicer</em> is a <em>WritableStream</em></p>
<div class="pilwrap" id="dicer-special-events">
  <h2>
    <a href="#dicer-special-events" name="dicer-special-events" class="pilcrow"></a>
Dicer (special) events
  </h2>
</div>
<ul>
<li>
<p><strong>finish</strong>() - Emitted when all parts have been parsed and the Dicer instance has been ended.</p>
</li>
<li>
<p><strong>part</strong>(&lt; <em>PartStream</em> &gt;stream) - Emitted when a new part has been found.</p>
</li>
<li>
<p><strong>preamble</strong>(&lt; <em>PartStream</em> &gt;stream) - Emitted for preamble if you should happen to need it (can usually be ignored).</p>
</li>
<li>
<p><strong>trailer</strong>(&lt; <em>Buffer</em> &gt;data) - Emitted when trailing data was found after the terminating boundary (as with the preamble, this can usually be ignored too).</p>
</li>
</ul>
<div class="pilwrap" id="dicer-methods">
  <h2>
    <a href="#dicer-methods" name="dicer-methods" class="pilcrow"></a>
Dicer methods
  </h2>
</div>
<ul>
<li>
<p><strong>(constructor)</strong>(&lt; <em>object</em> &gt;config) - Creates and returns a new Dicer instance with the following valid <code>config</code> settings:</p>
<ul>
<li>
<p><strong>boundary</strong> - <em>string</em> - This is the boundary used to detect the beginning of a new part.</p>
</li>
<li>
<p><strong>headerFirst</strong> - <em>boolean</em> - If true, preamble header parsing will be performed first.</p>
</li>
<li>
<p><strong>maxHeaderPairs</strong> - <em>integer</em> - The maximum number of header key=&gt;value pairs to parse <strong>Default:</strong> 2000 (same as node's http).</p>
</li>
</ul>
</li>
<li>
<p><strong>setBoundary</strong>(&lt; <em>string</em> &gt;boundary) - <em>(void)</em> - Sets the boundary to use for parsing and performs some initialization needed for parsing. You should only need to use this if you set <code>headerFirst</code> to true in the constructor and are parsing the boundary from the preamble header.</p>
</li>
</ul>
<p><em>PartStream</em> is a <em>ReadableStream</em></p>
<div class="pilwrap" id="partstream-special-events">
  <h2>
    <a href="#partstream-special-events" name="partstream-special-events" class="pilcrow"></a>
PartStream (special) events
  </h2>
</div>
<ul>
<li><strong>header</strong>(&lt; <em>object</em> &gt;header) - An object containing the header for this particular part. Each property value is an <em>array</em> of one or more string values.</li>
</ul>
</div>
  </div>
</body>
</html>
