<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules\\depd\\index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>!
depd
Copyright(c) 2014-2017 Douglas Christopher Wilson
MIT Licensed</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module dependencies.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> callSiteToString = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./lib/compat'</span>).callSiteToString
<span class="hljs-keyword">var</span> eventListenerCount = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./lib/compat'</span>).eventListenerCount
<span class="hljs-keyword">var</span> relative = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>).relative

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module exports.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">module</span>.exports = depd

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get the path to base files on.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> basePath = process.cwd()

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Determine if namespace is contained in the string.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">containsNamespace</span> (<span class="hljs-params">str, namespace</span>) </span>{
  <span class="hljs-keyword">var</span> vals = str.split(<span class="hljs-regexp">/[ ,]+/</span>)
  <span class="hljs-keyword">var</span> ns = <span class="hljs-built_in">String</span>(namespace).toLowerCase()

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; vals.length; i++) {
    <span class="hljs-keyword">var</span> val = vals[i]

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>namespace contained</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (val &amp;&amp; (val === <span class="hljs-string">'*'</span> || val.toLowerCase() === ns)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Convert a data descriptor to accessor descriptor.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">convertDataDescriptorToAccessor</span> (<span class="hljs-params">obj, prop, message</span>) </span>{
  <span class="hljs-keyword">var</span> descriptor = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(obj, prop)
  <span class="hljs-keyword">var</span> value = descriptor.value

  descriptor.get = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getter</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> value }

  <span class="hljs-keyword">if</span> (descriptor.writable) {
    descriptor.set = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setter</span> (<span class="hljs-params">val</span>) </span>{ <span class="hljs-keyword">return</span> (value = val) }
  }

  <span class="hljs-keyword">delete</span> descriptor.value
  <span class="hljs-keyword">delete</span> descriptor.writable

  <span class="hljs-built_in">Object</span>.defineProperty(obj, prop, descriptor)

  <span class="hljs-keyword">return</span> descriptor
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>Create arguments string to keep arity.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createArgumentsString</span> (<span class="hljs-params">arity</span>) </span>{
  <span class="hljs-keyword">var</span> str = <span class="hljs-string">''</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arity; i++) {
    str += <span class="hljs-string">', arg'</span> + i
  }

  <span class="hljs-keyword">return</span> str.substr(<span class="hljs-number">2</span>)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Create stack string from stack.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createStackString</span> (<span class="hljs-params">stack</span>) </span>{
  <span class="hljs-keyword">var</span> str = <span class="hljs-keyword">this</span>.name + <span class="hljs-string">': '</span> + <span class="hljs-keyword">this</span>.namespace

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.message) {
    str += <span class="hljs-string">' deprecated '</span> + <span class="hljs-keyword">this</span>.message
  }

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; stack.length; i++) {
    str += <span class="hljs-string">'\n    at '</span> + callSiteToString(stack[i])
  }

  <span class="hljs-keyword">return</span> str
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>Create deprecate for namespace in caller.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">depd</span> (<span class="hljs-params">namespace</span>) </span>{
  <span class="hljs-keyword">if</span> (!namespace) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'argument namespace is required'</span>)
  }

  <span class="hljs-keyword">var</span> stack = getStack()
  <span class="hljs-keyword">var</span> site = callSiteLocation(stack[<span class="hljs-number">1</span>])
  <span class="hljs-keyword">var</span> file = site[<span class="hljs-number">0</span>]

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deprecate</span> (<span class="hljs-params">message</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>call to self as log</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    log.call(deprecate, message)
  }

  deprecate._file = file
  deprecate._ignored = isignored(namespace)
  deprecate._namespace = namespace
  deprecate._traced = istraced(namespace)
  deprecate._warned = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>)

  deprecate.function = wrapfunction
  deprecate.property = wrapproperty

  <span class="hljs-keyword">return</span> deprecate
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<div class="dox">
<div class="summary">
<p>Determine if namespace is ignored.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isignored</span> (<span class="hljs-params">namespace</span>) </span>{
  <span class="hljs-comment">/* istanbul ignore next: tested in a child processs */</span>
  <span class="hljs-keyword">if</span> (process.noDeprecation) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>--no-deprecation support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }

  <span class="hljs-keyword">var</span> str = process.env.NO_DEPRECATION || <span class="hljs-string">''</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>namespace ignored</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">return</span> containsNamespace(str, namespace)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<div class="dox">
<div class="summary">
<p>Determine if namespace is traced.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">istraced</span> (<span class="hljs-params">namespace</span>) </span>{
  <span class="hljs-comment">/* istanbul ignore next: tested in a child processs */</span>
  <span class="hljs-keyword">if</span> (process.traceDeprecation) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>--trace-deprecation support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }

  <span class="hljs-keyword">var</span> str = process.env.TRACE_DEPRECATION || <span class="hljs-string">''</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>namespace traced</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">return</span> containsNamespace(str, namespace)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<div class="dox">
<div class="summary">
<p>Display deprecation message.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span> (<span class="hljs-params">message, site</span>) </span>{
  <span class="hljs-keyword">var</span> haslisteners = eventListenerCount(process, <span class="hljs-string">'deprecation'</span>) !== <span class="hljs-number">0</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>abort early if no destination</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!haslisteners &amp;&amp; <span class="hljs-keyword">this</span>._ignored) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">var</span> caller
  <span class="hljs-keyword">var</span> callFile
  <span class="hljs-keyword">var</span> callSite
  <span class="hljs-keyword">var</span> depSite
  <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>
  <span class="hljs-keyword">var</span> seen = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">var</span> stack = getStack()
  <span class="hljs-keyword">var</span> file = <span class="hljs-keyword">this</span>._file

  <span class="hljs-keyword">if</span> (site) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>provided site</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    depSite = site
    callSite = callSiteLocation(stack[<span class="hljs-number">1</span>])
    callSite.name = depSite.name
    file = callSite[<span class="hljs-number">0</span>]
  } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>get call site</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    i = <span class="hljs-number">2</span>
    depSite = callSiteLocation(stack[i])
    callSite = depSite
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>get caller of deprecated thing in relation to file</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">for</span> (; i &lt; stack.length; i++) {
    caller = callSiteLocation(stack[i])
    callFile = caller[<span class="hljs-number">0</span>]

    <span class="hljs-keyword">if</span> (callFile === file) {
      seen = <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (callFile === <span class="hljs-keyword">this</span>._file) {
      file = <span class="hljs-keyword">this</span>._file
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (seen) {
      <span class="hljs-keyword">break</span>
    }
  }

  <span class="hljs-keyword">var</span> key = caller
    ? depSite.join(<span class="hljs-string">':'</span>) + <span class="hljs-string">'__'</span> + caller.join(<span class="hljs-string">':'</span>)
    : <span class="hljs-literal">undefined</span>

  <span class="hljs-keyword">if</span> (key !== <span class="hljs-literal">undefined</span> &amp;&amp; key <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>._warned) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>already warned</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">this</span>._warned[key] = <span class="hljs-literal">true</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>generate automatic message from call site</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> msg = message
  <span class="hljs-keyword">if</span> (!msg) {
    msg = callSite === depSite || !callSite.name
      ? defaultMessage(depSite)
      : defaultMessage(callSite)
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>emit deprecation if listeners exist</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (haslisteners) {
    <span class="hljs-keyword">var</span> err = DeprecationError(<span class="hljs-keyword">this</span>._namespace, msg, stack.slice(i))
    process.emit(<span class="hljs-string">'deprecation'</span>, err)
    <span class="hljs-keyword">return</span>
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>format and write message</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> format = process.stderr.isTTY
    ? formatColor
    : formatPlain
  <span class="hljs-keyword">var</span> output = format.call(<span class="hljs-keyword">this</span>, msg, caller, stack.slice(i))
  process.stderr.write(output + <span class="hljs-string">'\n'</span>, <span class="hljs-string">'utf8'</span>)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get call site location as array.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callSiteLocation</span> (<span class="hljs-params">callSite</span>) </span>{
  <span class="hljs-keyword">var</span> file = callSite.getFileName() || <span class="hljs-string">'&lt;anonymous&gt;'</span>
  <span class="hljs-keyword">var</span> line = callSite.getLineNumber()
  <span class="hljs-keyword">var</span> colm = callSite.getColumnNumber()

  <span class="hljs-keyword">if</span> (callSite.isEval()) {
    file = callSite.getEvalOrigin() + <span class="hljs-string">', '</span> + file
  }

  <span class="hljs-keyword">var</span> site = [file, line, colm]

  site.callSite = callSite
  site.name = callSite.getFunctionName()

  <span class="hljs-keyword">return</span> site
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<div class="dox">
<div class="summary">
<p>Generate a default message from the site.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defaultMessage</span> (<span class="hljs-params">site</span>) </span>{
  <span class="hljs-keyword">var</span> callSite = site.callSite
  <span class="hljs-keyword">var</span> funcName = site.name

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>make useful anonymous name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!funcName) {
    funcName = <span class="hljs-string">'&lt;anonymous@'</span> + formatLocation(site) + <span class="hljs-string">'&gt;'</span>
  }

  <span class="hljs-keyword">var</span> context = callSite.getThis()
  <span class="hljs-keyword">var</span> typeName = context &amp;&amp; callSite.getTypeName()

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>ignore useless type name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (typeName === <span class="hljs-string">'Object'</span>) {
    typeName = <span class="hljs-literal">undefined</span>
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>make useful type name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (typeName === <span class="hljs-string">'Function'</span>) {
    typeName = context.name || typeName
  }

  <span class="hljs-keyword">return</span> typeName &amp;&amp; callSite.getMethodName()
    ? typeName + <span class="hljs-string">'.'</span> + funcName
    : funcName
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<div class="dox">
<div class="summary">
<p>Format deprecation message without color.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatPlain</span> (<span class="hljs-params">msg, caller, stack</span>) </span>{
  <span class="hljs-keyword">var</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toUTCString()

  <span class="hljs-keyword">var</span> formatted = timestamp +
    <span class="hljs-string">' '</span> + <span class="hljs-keyword">this</span>._namespace +
    <span class="hljs-string">' deprecated '</span> + msg

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>add stack trace</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._traced) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; stack.length; i++) {
      formatted += <span class="hljs-string">'\n    at '</span> + callSiteToString(stack[i])
    }

    <span class="hljs-keyword">return</span> formatted
  }

  <span class="hljs-keyword">if</span> (caller) {
    formatted += <span class="hljs-string">' at '</span> + formatLocation(caller)
  }

  <span class="hljs-keyword">return</span> formatted
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<div class="dox">
<div class="summary">
<p>Format deprecation message with color.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatColor</span> (<span class="hljs-params">msg, caller, stack</span>) </span>{
  <span class="hljs-keyword">var</span> formatted = <span class="hljs-string">'\x1b[36;1m'</span> + <span class="hljs-keyword">this</span>._namespace + <span class="hljs-string">'\x1b[22;39m'</span> + <span class="hljs-comment">// bold cyan</span>
    <span class="hljs-string">' \x1b[33;1mdeprecated\x1b[22;39m'</span> + <span class="hljs-comment">// bold yellow</span>
    <span class="hljs-string">' \x1b[0m'</span> + msg + <span class="hljs-string">'\x1b[39m'</span> <span class="hljs-comment">// reset</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>add stack trace</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._traced) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; stack.length; i++) {
      formatted += <span class="hljs-string">'\n    \x1b[36mat '</span> + callSiteToString(stack[i]) + <span class="hljs-string">'\x1b[39m'</span> <span class="hljs-comment">// cyan</span>
    }

    <span class="hljs-keyword">return</span> formatted
  }

  <span class="hljs-keyword">if</span> (caller) {
    formatted += <span class="hljs-string">' \x1b[36m'</span> + formatLocation(caller) + <span class="hljs-string">'\x1b[39m'</span> <span class="hljs-comment">// cyan</span>
  }

  <span class="hljs-keyword">return</span> formatted
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<div class="dox">
<div class="summary">
<p>Format call site location.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatLocation</span> (<span class="hljs-params">callSite</span>) </span>{
  <span class="hljs-keyword">return</span> relative(basePath, callSite[<span class="hljs-number">0</span>]) +
    <span class="hljs-string">':'</span> + callSite[<span class="hljs-number">1</span>] +
    <span class="hljs-string">':'</span> + callSite[<span class="hljs-number">2</span>]
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get the stack as array of call sites.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStack</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> limit = <span class="hljs-built_in">Error</span>.stackTraceLimit
  <span class="hljs-keyword">var</span> obj = {}
  <span class="hljs-keyword">var</span> prep = <span class="hljs-built_in">Error</span>.prepareStackTrace

  <span class="hljs-built_in">Error</span>.prepareStackTrace = prepareObjectStackTrace
  <span class="hljs-built_in">Error</span>.stackTraceLimit = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">10</span>, limit)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>capture the stack</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-built_in">Error</span>.captureStackTrace(obj)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>slice this function off the top</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> stack = obj.stack.slice(<span class="hljs-number">1</span>)

  <span class="hljs-built_in">Error</span>.prepareStackTrace = prep
  <span class="hljs-built_in">Error</span>.stackTraceLimit = limit

  <span class="hljs-keyword">return</span> stack
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<div class="dox">
<div class="summary">
<p>Capture call site stack from v8.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prepareObjectStackTrace</span> (<span class="hljs-params">obj, stack</span>) </span>{
  <span class="hljs-keyword">return</span> stack
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<div class="dox">
<div class="summary">
<p>Return a wrapped function in a deprecation message.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrapfunction</span> (<span class="hljs-params">fn, message</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">'function'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'argument fn must be a function'</span>)
  }

  <span class="hljs-keyword">var</span> args = createArgumentsString(fn.length)
  <span class="hljs-keyword">var</span> deprecate = <span class="hljs-keyword">this</span> <span class="hljs-comment">// eslint-disable-line no-unused-vars</span>
  <span class="hljs-keyword">var</span> stack = getStack()
  <span class="hljs-keyword">var</span> site = callSiteLocation(stack[<span class="hljs-number">1</span>])

  site.name = fn.name

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>eslint-disable-next-line no-eval</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> deprecatedfn = <span class="hljs-built_in">eval</span>(<span class="hljs-string">'(function ('</span> + args + <span class="hljs-string">') {\n'</span> +
    <span class="hljs-string">'"use strict"\n'</span> +
    <span class="hljs-string">'log.call(deprecate, message, site)\n'</span> +
    <span class="hljs-string">'return fn.apply(this, arguments)\n'</span> +
    <span class="hljs-string">'})'</span>)

  <span class="hljs-keyword">return</span> deprecatedfn
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<div class="dox">
<div class="summary">
<p>Wrap property in a deprecation message.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrapproperty</span> (<span class="hljs-params">obj, prop, message</span>) </span>{
  <span class="hljs-keyword">if</span> (!obj || (<span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">'function'</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'argument obj must be object'</span>)
  }

  <span class="hljs-keyword">var</span> descriptor = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(obj, prop)

  <span class="hljs-keyword">if</span> (!descriptor) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'must call property on owner object'</span>)
  }

  <span class="hljs-keyword">if</span> (!descriptor.configurable) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'property must be configurable'</span>)
  }

  <span class="hljs-keyword">var</span> deprecate = <span class="hljs-keyword">this</span>
  <span class="hljs-keyword">var</span> stack = getStack()
  <span class="hljs-keyword">var</span> site = callSiteLocation(stack[<span class="hljs-number">1</span>])

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>set site name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  site.name = prop

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>convert data descriptor</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-string">'value'</span> <span class="hljs-keyword">in</span> descriptor) {
    descriptor = convertDataDescriptorToAccessor(obj, prop, message)
  }

  <span class="hljs-keyword">var</span> get = descriptor.get
  <span class="hljs-keyword">var</span> set = descriptor.set

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>wrap getter</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> get === <span class="hljs-string">'function'</span>) {
    descriptor.get = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getter</span> (<span class="hljs-params"></span>) </span>{
      log.call(deprecate, message, site)
      <span class="hljs-keyword">return</span> get.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>)
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>wrap setter</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> set === <span class="hljs-string">'function'</span>) {
    descriptor.set = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setter</span> (<span class="hljs-params"></span>) </span>{
      log.call(deprecate, message, site)
      <span class="hljs-keyword">return</span> set.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>)
    }
  }

  <span class="hljs-built_in">Object</span>.defineProperty(obj, prop, descriptor)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<div class="dox">
<div class="summary">
<p>Create DeprecationError for deprecation</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">DeprecationError</span> (<span class="hljs-params">namespace, message, stack</span>) </span>{
  <span class="hljs-keyword">var</span> error = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>()
  <span class="hljs-keyword">var</span> stackString

  <span class="hljs-built_in">Object</span>.defineProperty(error, <span class="hljs-string">'constructor'</span>, {
    <span class="hljs-attr">value</span>: DeprecationError
  })

  <span class="hljs-built_in">Object</span>.defineProperty(error, <span class="hljs-string">'message'</span>, {
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">value</span>: message,
    <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
  })

  <span class="hljs-built_in">Object</span>.defineProperty(error, <span class="hljs-string">'name'</span>, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-string">'DeprecationError'</span>,
    <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
  })

  <span class="hljs-built_in">Object</span>.defineProperty(error, <span class="hljs-string">'namespace'</span>, {
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">value</span>: namespace,
    <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
  })

  <span class="hljs-built_in">Object</span>.defineProperty(error, <span class="hljs-string">'stack'</span>, {
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (stackString !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">return</span> stackString
      }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<p>prepare stack trace</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">return</span> (stackString = createStackString.call(<span class="hljs-keyword">this</span>, stack))
    },
    <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setter</span> (<span class="hljs-params">val</span>) </span>{
      stackString = val
    }
  })

  <span class="hljs-keyword">return</span> error
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
